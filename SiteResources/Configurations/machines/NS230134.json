{
	"NS230134": {
		"ServicesComments": [
			"SQL Server message 1844, Severity 16, State 1, Server NS230134",
			"L'instruction BACKUP DATABASE WITH COMPRESSION n'est pas prise en charge sur Web Edition (64-bit)."
		],
		"Services": {
			"Canal33": {
				"instance": "MSSQLSERVER",
				"databases": [
					"Canal33"
				],
				"workloads": {
					"canal33.live.morning": [
						{
							"label": "(Production Live) Sauvegarde quotidienne de la base Canall33",
							"commands": [
								"dbms.pl backup -nocolored -service Canal33 -full",
								"ttp.pl copydirs -nocolored -sourcecmd \"dbms.pl vars -nocolored -backupsDir\" -targetcmd \"dbms.pl vars -nocolored -archivesDir\" -dirs",
								"dbms.pl telemetry -nocolored -service Canal33 -dbsize",
								"dbms.pl telemetry -nocolored -service Canal33 -tabcount",
								"ttp.pl sizedir -nocolored -dirpath C:\\Users\\Public\\CANAL33_LOGS -mqtt -http"
							]
						}
					],
					"canal33.live.every.5h": [
						{
							"label": "(Production Live) Sauvegarde différentielle en journée",
							"commands_x": [
								"-> désactivée sur ns230134 faute d'espace disque suffisant",
								"dbms.pl backup -nocolored -service Canal33 -diff",
								"ttp.pl copydirs -nocolored -sourcecmd \"dbms.pl vars -nocolored -backupsDir\" -targetcmd \"dbms.pl vars -nocolored -archivesDir\" -dirs"
							]
						}
					],
					"canal33.live.evening": [
					],
					"canal33.backup": [
						{
							"label": "(PRODUCTION BACKUP) Surveillance, transfert et restauration des sauvegardes de la production",
							"commands": [
								"daemon.pl stop -nocolored -json [eval:File::Spec->catdir( $TTPVars->{config}{site}{daemonsDir}, 'canal33-backup-monitor-daemon.json' )] -ignore -wait 2",
								"daemon.pl start -nocolored -json [eval:File::Spec->catdir( $TTPVars->{config}{site}{daemonsDir}, 'canal33-backup-monitor-daemon.json' )] -- -remote WS12PROD1"
							]
						}
					]
				},
				"status": {
					"commands": [
						"ssh inlingua-user@<HOST> dbms.pl status -nocolored -service <SERVICE> -state -mqtt -http",
						"ssh inlingua-user@<HOST> services.pl live -nocolored -service <SERVICE> -environment X -next -mqtt -http",
						"http.pl get -nocolored -url http://canal33.blingua.net -label service=<SERVICE> -nomqtt -http",
						"http.pl get -nocolored -url http://canal33.backup.blingua.net -label service=<SERVICE> -nomqtt -http",
						"http.pl get -nocolored -url https://c33.blingua.fr -label service=<SERVICE> -nomqtt -http",
						"http.pl get -nocolored -url https://c33.backup.blingua.net -label service=<SERVICE> -nomqtt -http",
						"ssh inlingua-user@<HOST> daemon.pl status -bname canal33-backup-monitor-daemon.json -http -- -metric ttp_service_daemon -label service=<SERVICE> -label role=backup -label environment=X"
					],
					"get_live": "http.pl get -nocolored -url http://canal33.blingua.net -header X-Sent-By -ignore"
				},
				"switch_comments": [
					"These commands have to be run when we want switch the status of a machine, from live to backup, or from backup to live",
					"They have to be run via 'SiteResources\\Commands\\extern_service_switch.pl' script."
				],
				"switch": {
					"to_backup": {
						"commands": [
							"ssh inlingua-adm@<HOST> sc stop Canal33Ftp",
							"ssh inlingua-adm@<HOST> sc config start= disabled Canal33Ftp",
							"ssh inlingua-adm@<HOST> sc stop Canal33Svc",
							"ssh inlingua-adm@<HOST> sc config start= disabled Canal33Svc"
						]
					},
					"to_live": {
						"commands": [
							"ssh inlingua-user@<HOST> daemon.pl stop -nocolored -json [eval:File::Spec->catdir( $TTPVars->{config}{site}{daemonsDir}, 'canal33-backup-monitor-daemon.json' )] -ignore -wait 2",
							"ssh inlingua-adm@<HOST> [eval:File::Spec->catdir( $TTPVars->{config}{site}{commandsDir}, 'scheduled_set_status.cmd' )] \\Inlingua\\canal33.backup /Disable",
							"ssh inlingua-adm@<HOST> sc config start= auto Canal33Ftp",
							"ssh inlingua-adm@<HOST> sc start Canal33Ftp",
							"ssh inlingua-adm@<HOST> sc config start= auto Canal33Svc",
							"ssh inlingua-adm@<HOST> sc start Canal33Svc",
							"ovh.pl ipswitch -ip ip-87.98.189.58 -to ns230134.ovh.net -wait -url http://canal33.blingua.net"
						]
					}
				}
			},
			"Dom.2008": {
				"instance": "MSSQLSERVER",
				"databases": [
					"Dom1",
					"Dom33"
				],
				"workloads": {
					"daily.morning": [
						{
							"label": "Sauvegarde quotidienne des bases Dom",
							"comment": "pwi 24-02-08 à étudier, mais peut-être bien que ce ne sont que des bases de dev, donc à transférer vers un autre environnement..",
							"commands": [
								"dbms.pl backup -nocolored -instance MSSQLSERVER -database Dom1 -full",
								"dbms.pl backup -nocolored -instance MSSQLSERVER -database Dom33 -full",
								"ttp.pl copydirs -nocolored -sourcecmd \"dbms.pl vars -nocolored -backupsDir\" -targetcmd \"dbms.pl vars -nocolored -archivesDir\" -dirs",
								"dbms.pl telemetry -nocolored -service Dom.2008 -dbsize",
								"dbms.pl telemetry -nocolored -service Dom.2008 -tabcount"
							]
						}
					]
				}
			},
			"Technical.Services": {
				"hidden": true,
				"workloads": {
					"daily.morning": [
						{
							"label": "Purge backups directory",
							"order": "00",
							"order_comments": [
								"order='00' is very first as tasks are ordered in Ascii order: [0-9A-Za-z]",
								"ns230134 has very low free space on its local disk, just enough for one backup set, not two.",
								"Make sure the SQLBackups is empty before our daily full backups. It will be immediately copied to the archive, and moved again to the archive at evening.",
								"daily.morning is scheduled at 05:00h - while canal33.live.morning is at 06:00"
							],
							"commands": [
								"ttp.pl pull -nocolored",
								"ttp.pl purgedirs -nocolored -dircmd \"dbms.pl vars -nocolored -backupsRoot\" -keep 0",
								"ttp.pl purgedirs -nocolored -dircmd \"dbms.pl vars -nocolored -archivesRoot\" -keep 5",
								"ttp.pl purgedirs -nocolored -dircmd \"ttp.pl vars -nocolored -logsRoot\" -keep 7"
							]
						},
						{
							"label": "Do something at the end of the daily.morning workload",
							"order": "zz",
							"commands": [
							]
						}
					],
					"daily.evening": [
						{
							"label": "Do something at the evening",
							"commands": [
							]
						}
					],
					"startup": [
						{
							"label": "Advertize at startup",
							"commands": [
								"call [eval:File::Spec->catdir( $TTPVars->{config}{site}{commandsDir}, 'startup.cmd' )]"
							]
						}
					]
				}
			}
		},
		"DBMSInstancesComments": [
		],
		"DBMSInstances": {
			"MSSQLSERVER": {
				"package": "Mods::SqlServer",
				"dataPath": "C:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\DATA"
			}
		},
		"DBMS": {
			"archivesDir": "[eval:File::Spec->catdir( Mods::Path::dbmsArchivesRoot(), localtime->strftime( '%y%m%d' ))]",
			"archivesRoot": "\\[eval:File::Spec->catdir( '\\ftpback-rbx7-618.ovh.net', 'ns3153065.ip-51-91-25.eu', '<HOST>', 'SQLBackups' )]"
		},
		"Environment": {
			"type_comments": [
				"X is production; this same indicator must be used both for production live and for production backup",
				"D is for development"
			],
			"type": "X"
		},
		"remoteShare": "\\\\ns230134.ovh.net\\C"
	}
}
